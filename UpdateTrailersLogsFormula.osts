{"version":"0.2.0","body":"/*\nPURPOSE: Inputs formulas into the trailers logs excel file automatically to change what information it is pulling from\nAUTHOR: Raymond Levi Triana\nDATE: 11/15/22\nWORKBOOK: TrailersLogs.xlsx\n*/\n\n\nvar trailers_table: ExcelScript.Table//used as a buffer to search other files using formulas\nvar data_table: ExcelScript.Table//final table pivot tables read from\nvar weeks: Number[]//unique weeks found within data\nvar today: Date//today in unix format\nvar today_excel: number//today is excel format\nvar this_monday: Date//this week's monday in unix format\nvar formula: string//the formulas used to query the doorsheet\nvar trailer_formula: string\nvar size_formula: string\n\nvar output:string[][] = new Array()\n\n\nlet days = {\n    monday: 1,\n    tuesday: 2,\n    wednesday: 3,\n    thursday: 4,\n    friday: 5\n}\nenum months{January,February,March,April,May,June,July,August,September,October,November,December}\n\nfunction main(workbook: ExcelScript.Workbook) {\n    init_script(workbook)\n    console.log(today.getMonth()+1 )\n    update_formula()\n}\n\nfunction update_formula() {\n    var row_count = trailers_table.getRowCount() + parseInt(trailers_table.getRange().getAddress().split(\":\")[0].split(\"!A\")[1])\n    console.log(row_count)\n    //clear the old formula from the table\n    trailers_table.getRangeBetweenHeaderAndTotal().clear(ExcelScript.ClearApplyTo.contents)\n    /*for(var i = 0; i < row_count-3; i++){\n      output.push(new Array())\n      output[i][0]=formula\n    }*/\n    console.log(output)\n    //set the new formula\n    trailers_table.getRangeBetweenHeaderAndTotal().getCell(0,2).setValue(formula)\n    trailers_table.getRangeBetweenHeaderAndTotal().getCell(0,2).autoFill(\"C4:C255\",ExcelScript.AutoFillType.fillCopy)\n\n    trailers_table.getRangeBetweenHeaderAndTotal().getCell(0,0).setValue(trailer_formula)\n    trailers_table.getRangeBetweenHeaderAndTotal().getCell(0, 0).autoFill(\"A4:A255\",ExcelScript.AutoFillType.fillCopy)\n\n    trailers_table.getRangeBetweenHeaderAndTotal().getCell(0,1).setValue(size_formula)\n    trailers_table.getRangeBetweenHeaderAndTotal().getCell(0,1).autoFill(\"B4:B255\",ExcelScript.AutoFillType.fillCopy)\n    //trailers_table.getRangeBetweenHeaderAndTotal().getColumn(2).setValues(output)\n    //trailers_table.getRangeBetweenHeaderAndTotal().getColumn(2).setValue(formula)\n}\n\n\n\nfunction init_script(workbook: ExcelScript.Workbook) {\n    trailers_table = workbook.getWorksheet(\"Trailers\").getTable(\"TrailersTable\")\n    data_table = workbook.getWorksheet(\"Data\").getTable(\"DataTable\")\n\n    weeks = new Array()\n    var temp = data_table.getRangeBetweenHeaderAndTotal().getColumn(0).getValues()\n    for (var item in temp) {\n        if (!weeks.includes(parseInt(temp[item][0].toString()))) {\n            weeks.push(parseInt(temp[item][0].toString()))\n        }\n    }\n    today = new Date()\n    today_excel = JSDateToExcelDate(today)\n\n    this_monday = new Date()\n    this_monday.setDate(today.getDate() - (today.getDay() - 1))\n\n    //FORMULA\n    var file = \"'https://cheneybrothers.sharepoint.com/sites/OcalaOperations/Shared Documents/Dispatch/Door Sheets \" + today.getFullYear().toString() + \"/\" + months[today.getMonth()] + \" \" + today.getFullYear().toString() + \"/[DOOR SHEET \" + (today.getMonth() + 1)+\"-\" + today.getDate()+\"-\" + today.getFullYear().toString().substr(2, 2)+\".xlsx]Ending Sheet'!\"\n\n    formula = \"=LET(Door_Sheet_Range,\" + file + \"$A$1: $Z$9999,Door_Sheet_Lookup,\" + file + \"$M:$M,IFERROR(IF(INDEX(Door_Sheet_Range, MATCH([@Number], Door_Sheet_Lookup, 0), 13)=[@Number], INDEX(Door_Sheet_Range, MATCH([@Number], Door_Sheet_Lookup, 0), 8), \\\"\\\"), \\\"\\\"))\"\n\n  trailer_formula =\"='https://cheneybrothers.sharepoint.com/sites/OcalaOperations/Shared Documents/Dispatch/Door Sheets \" + today.getFullYear().toString() + \"/\" + months[today.getMonth()] + \" \" + today.getFullYear().toString() + \"/[DOOR SHEET \" + (today.getMonth() + 1)+\"-\" + today.getDate()+\"-\" + today.getFullYear().toString().substr(2, 2)+\".xlsx]Ending Sheet'!$M5\"\n    size_formula = \"=INDEX(Inventory!A:B,MATCH([@Number],Inventory!A:A,0),2)\"\n}\n\nfunction ExcelDateToJSDate(date: number) {\n    return new Date(Math.round((date - 25569) * 86400 * 1000))\n}\n\nfunction JSDateToExcelDate(inDate: Date) {\n    let date = new Date();\n    let converted = 25569.0 + ((date.getTime() - (date.getTimezoneOffset() * 60 * 1000)) / (1000 * 60 * 60 * 24));\n    return converted\n}","description":"","parameterInfo":"{\"originalParameterOrder\":[],\"parameterSchema\":{\"type\":\"object\",\"default\":{},\"x-ms-visibility\":\"internal\"},\"returnSchema\":{\"type\":\"object\",\"properties\":{}}}","apiInfo":"{\"variant\":\"synchronous\",\"variantVersion\":2}"}