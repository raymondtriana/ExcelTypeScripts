{"version":"0.2.0","body":"/**\n * AUTHOR: Raymond Levi Triana\n * PURPOSE: Auto archive weekly head counts into a table\n * WOORKBOOK: Headcount_Weekly in Transportation Mgmt\n * DATE: 12/12/22\n */\nconst yards = [\"OCALA\",\"ORLANDO\",\"DAYTONA\",\"JACKSONVILLE\",\"SAVANNAH\",\"MACON\",\"TALLAHASSEE\",\"PENSACOLA\"]\nvar buffer :(string|number|boolean)[][];\n\nvar thisMonday:Date;\nfunction main(workbook: ExcelScript.Workbook) {\n  setThisMonday()\n  initialize_buffers(workbook);\n  addToArchive(workbook.getWorksheet(\"Archive\").getTable(\"archiveTable\"))\n  //resetWorkbook(workbook)\n}\n\nfunction resetWorkbook(workbook: ExcelScript.Workbook){\n  var data_sheet : ExcelScript.Worksheet;\n  data_sheet = workbook.getWorksheet(\"Data\")\n  data_sheet.getProtection().unprotect();//UNPROTECT DATA SHEET\n  data_sheet.getRange(\"B3:I11\").clear(ExcelScript.ClearApplyTo.contents);\n  data_sheet.getRange(\"D3:D11\").setFormula(\"=$C3-$B3\");\n  data_sheet.getRange(\"E3:E11\").setFormula(\"=ROUNDUP($C3*1.2,0)\");\n  data_sheet.getRange(\"H3:H11\").setFormula(\"=$G3-$F3\");\n  data_sheet.getRange(\"I3:I11\").setFormula(\"=ROUNDUP($G3*1.2,0)\");\n  data_sheet.getProtection().protect();//PROTECT DATA SHEET\n}\n\nfunction addToArchive(table:ExcelScript.Table){\n  //adds the data to the archive table\n  table.getWorksheet().getProtection().unprotect();//UNPROTECT ARCHIVE TABLE\n  table.addRows(-1, buffer)\n  table.getWorksheet().getProtection().protect();//PROTECT ARCHIVE TABLE\n}\n\nfunction setThisMonday(){\n  //Find the day associated with this week's monday\n  thisMonday = new Date(Date.now());\n  thisMonday.setDate(thisMonday.getDate()-thisMonday.getDay()+1)\n}\n\nfunction initialize_buffers(workbook : ExcelScript.Workbook){\n  var data_sheet: ExcelScript.Worksheet = workbook.getWorksheet(\"Data\");\n  var range: ExcelScript.Range = data_sheet.getRange(\"A3:I11\")\n  buffer = range.getValues();//GET THE RANGE's VALUES INTO MATRIX\n  for(var row in buffer){\n    buffer[row].reverse().push((thisMonday.getMonth()+1)+\"/\"+thisMonday.getDate()+\"/\"+thisMonday.getFullYear())\n    buffer[row].reverse()\n  }\n}","description":"","parameterInfo":"{\"originalParameterOrder\":[],\"parameterSchema\":{\"type\":\"object\",\"default\":{},\"x-ms-visibility\":\"internal\"},\"returnSchema\":{\"type\":\"object\",\"properties\":{}}}","apiInfo":"{\"variant\":\"synchronous\",\"variantVersion\":2}"}