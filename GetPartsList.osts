{"version":"0.2.0","body":"var interface_sheet:ExcelScript.Worksheet\nvar database_sheet:ExcelScript.Worksheet\nvar database_table:ExcelScript.Table\nvar database_range:ExcelScript.Range\nvar parts_table:ExcelScript.Table\n\nfunction main(workbook: ExcelScript.Workbook) {\n    init_script(workbook)\n    reset_table()\n    populate_table(cache_data())\n}\nfunction init_script(workbook: ExcelScript.Workbook){\n    database_sheet=workbook.getWorksheet(\"Database\")\n    database_table=database_sheet.getTable(\"Table1\")\n    database_range=database_table.getRangeBetweenHeaderAndTotal()\n    interface_sheet=workbook.getWorksheet(\"Interface\")\n    parts_table = interface_sheet.getTable(\"Table4\")\n}\n\nfunction reset_table(){\n  var parts_range = parts_table.getRangeBetweenHeaderAndTotal()\n  parts_range.clear(ExcelScript.ClearApplyTo.contents)\n  parts_range.getColumn(2).setFormula(\"=IF(INDEX(Table3,MATCH($B28,Inventory!$A:$A,0)-1,2)<>\\\"\\\",INDEX(Table3,MATCH($B28,Inventory!$A:$A,0)-1,2),\\\"\\\")\")\n  parts_range.getColumn(3).setFormula(\"=IF(INDEX(Table3,MATCH($B28,Inventory!$A:$A,0)-1,3)<>\\\"\\\",INDEX(Table3,MATCH($B28,Inventory!$A:$A,0)-1,3),\\\"\\\")\")\n  parts_range.getColumn(4).setFormula(\"=IFERROR( INDEX(Table3,MATCH($B28,Inventory!$A:$A,0)-1,11)*$A28,\\\"\\\")\")\n}\n\nfunction cache_data(){\n  var parts_list:string[] = new Array()\n  var target_row = find_row(interface_sheet.getCell(1,1).getValue().toString())\n  parts_list = database_sheet.getCell(target_row,16).getValue().toString().split(\"\\n\")\n  return parts_list\n}\nfunction populate_table(parts_list:string[]){\n  for(var i=0;i<parts_list.length-1;i++){//loop through parts list\n    parts_table.getRangeBetweenHeaderAndTotal().getCell(i, 0).setValue(parts_list[i].split(\"QTY:\")[1].split(\",DESC:\")[0])\n    parts_table.getRangeBetweenHeaderAndTotal().getCell(i, 1).setValue(parts_list[i].split(\"ID:\")[1].split(\",QTY:\")[0])\n  }\n}\n\nfunction find_row(search_value: string) {\n  var targetCell = database_range.find(search_value, {\n    completeMatch: true,\n    searchDirection: ExcelScript.SearchDirection.forward\n  })\n  var targetRow: number = -1\n  if (targetCell) {//if ID is in table\n    targetRow = parseInt(targetCell.getAddress().split(\"A\")[1]) - 1\n    return targetRow\n  } else {//if ID is not in table\n    console.log(\"ERROR: ID IS NOT IN TABLE\")\n    return -1\n  }\n}","description":"","parameterInfo":"{\"originalParameterOrder\":[],\"parameterSchema\":{\"type\":\"object\",\"default\":{},\"x-ms-visibility\":\"internal\"},\"returnSchema\":{\"type\":\"object\",\"properties\":{}}}","apiInfo":"{\"variant\":\"synchronous\",\"variantVersion\":2}"}